/*! WIMP Member Directory - v0.1.0
 * http://beawimp.org/member-directory
 * Copyright (c) 2015;
 * Licensed GPLv2+
 */
var WMD;(function(e,t){"use strict";var i,a,n=e.document,o=e.wp,s=(e.tinymce,!1);WMD={init:function(){WMD.uploadLogo(),WMD.uploadPortfolio(),WMD.editListing(),WMD.saveListing(),t.fn.select2&&(t(".state-selection").select2({placeholder:"Select a state"}),t(".city-selection").select2({placeholder:"Select a city"}),t(".industry-selection").select2({placeholder:"What industries do you work with?"}),t(".tech-selection").select2({placeholder:"What technologies do you use?"}),t(".services-selection").select2({placeholder:"What services do you provide?"}))},uploadLogo:function(){t(n.getElementById("upload-image")).click(function(e){e.preventDefault(),WMD.media(t(e.target))})},uploadPortfolio:function(){t(n.getElementsByClassName("upload-portfolio")).click(function(e){e.preventDefault(),WMD.media(t(e.target))})},media:function(e){i!==undefined&&i.close(),i=o.media.frames.customHeader=o.media({title:"Upload image to your Directory Listing",library:{type:"image"},button:{text:"Insert Image"},multiple:!1}),i.on("select",function(){var a=i.state().get("selection").first().toJSON(),o=e.prev(),s=o.attr("id");if("logo-id"===s){var l=o.prev();o.val(a.id),l.val(a.url)}else if("portfolio"===o.attr("data-type")){var r=a.id,c="wmd[portfolio]["+r+"]",d=t(n.getElementById("portfolio-tmpl")).html();o.attr({name:c,"data-id":r}).val(a.url),e.parent().after(d)}else o.val(a.url)}),i.open()},editListing:function(){t(n.getElementsByClassName("add-new-tax")).click(function(e){e.preventDefault();var i=t(this),o=t(n.getElementById("wmd-listing-nonce")).val();a=i.prev();var s={term:a.val(),tax:a.attr("data-type")};"add-city"===i.attr("id")&&(s.isCity=!0),WMD.ajax("wmd_save_listing_tax",o,s)})},saveListing:function(){t(n.getElementById("wmd-listings")).submit(function(e){e.preventDefault();var i=t(this),a=t(n.getElementById("wmd-listing-nonce")).val(),o=this.elements,l={industry:{},tech:{},type:{},portfolio:{}};tinyMCE.triggerSave(),s=!0,l.content=tinyMCE.get("content").getContent(),l.id=i.find("#id").val();for(var r=0;o.length>r;r++){var c=o[r];if(c.hasAttribute("data-save")){var d=c.name.match(/wmd\[(.*)\]\[[0-9]{1,10}\]/);if(null!==d){var u=c.getAttribute("data-id");l.portfolio[u]=c.value}else l[c.id]="industry"===c.id?t("#industry").select2("val"):"techonologies"===c.id?t("#techonologies").select2("val"):"services"===c.id?t("#services").select2("val"):c.value}}WMD.ajax("wmd_save_listing_post",a,l)})},ajax:function(e,t,i){o.ajax.send(e,{success:WMD.ajaxSuccess,error:WMD.ajaxError,data:{nonce:t,data:i}})},ajaxSuccess:function(e){if(s)WMD.postNotifications("success",e);else{var t=a.next().attr("id");"add-city"===t?WMD.ajaxCitySuccess(e):WMD.ajaxTaxSuccess(e)}},ajaxTaxSuccess:function(e){var t='<option value="'+e.term_id+'" selected="selected">'+e.name+"*</option>",i=a.prev().prev(),n=i.select2("val"),o=e.name+" has been created and is being reviewed*. "+"Your option will display on your listing soon.";a.val("").prev().prev().append(t),n.push(e.term_id),i.select2("val",n),WMD.listingTaxNotification("success",o)},ajaxCitySuccess:function(e){console.log(e);var t='<option value="'+e.term_id+'" selected="selected">'+e.name+"</option>";a.val("").prev().append(t)},postNotifications:function(e,i){var a='<div class="wmd-notification wmd-'+e+'">'+i+' <a href="/membership-account/view-my-listing/">View Your Listing.</a></div',o=t(n.getElementById("wmd-notifications"));o.empty().html(a),t(n.getElementsByClassName("wmd-notification")).fadeIn()},ajaxError:function(e){s?WMD.postNotifications("error",e):WMD.listingTaxNotification("error",e)},listingTaxNotification:function(e,i){var o='<div class="wmd-notification wmd-'+e+'">'+i+"</div>";t(n.getElementsByClassName("wmd-notification")).fadeOut().remove(),a.next().after(o).next().fadeIn()},isInt:function(e){return!isNaN(e)&&function(e){return(0|e)===e}(parseFloat(e))},load:function(){t.flexslider&&t(".flexslider").flexslider({controlNav:!1})}},t(e).load(WMD.load),t(n).ready(WMD.init)})(this,jQuery);