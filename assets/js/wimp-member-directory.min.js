/*! WIMP Member Directory - v0.1.0
 * http://beawimp.org/member-directory
 * Copyright (c) 2015;
 * Licensed GPLv2+
 */
var WMD;!function(a,b){"use strict";var c,d,e=a.document,f=a.wp,g=(a.tinymce,!1);WMD={init:function(){WMD.uploadLogo(),WMD.uploadPortfolio(),WMD.editListing(),WMD.saveListing(),b.fn.select2&&(b(".state-selection").select2({placeholder:"Select a state"}),b(".city-selection").select2({placeholder:"Select a city"}),b(".industry-selection").select2({placeholder:"What industries do you work with?"}),b(".tech-selection").select2({placeholder:"What technologies do you use?"}),b(".services-selection").select2({placeholder:"What services do you provide?"}))},uploadLogo:function(){b(e.getElementById("upload-image")).click(function(a){a.preventDefault(),WMD.media(b(a.target))})},uploadPortfolio:function(){b(e.getElementsByClassName("upload-portfolio")).click(function(a){a.preventDefault(),WMD.media(b(a.target))})},media:function(a){"undefined"!=typeof c&&c.close(),c=f.media.frames.customHeader=f.media({title:"Upload image to your Directory Listing",library:{type:"image"},button:{text:"Insert Image"},multiple:!1}),c.on("select",function(){var d=c.state().get("selection").first().toJSON(),f=a.prev(),g=f.attr("id");if("logo-id"===g){var h=f.prev();f.val(d.id),h.val(d.url)}else if("portfolio"===f.attr("data-type")){var i=d.id,j="wmd[portfolio]["+i+"]",k=b(e.getElementById("portfolio-tmpl")).html();f.attr({name:j,"data-id":i}).val(d.url),a.parent().after(k)}else f.val(d.url)}),c.open()},editListing:function(){b(e.getElementsByClassName("add-new-tax")).click(function(a){a.preventDefault();var c=b(this),f=b(e.getElementById("wmd-listing-nonce")).val();d=c.prev();var g={term:d.val(),tax:d.attr("data-type")};"add-city"===c.attr("id")&&(g.isCity=!0),WMD.ajax("wmd_save_listing_tax",f,g)})},saveListing:function(){b(e.getElementById("wmd-listings")).submit(function(a){a.preventDefault();var c=b(this),d=b(e.getElementById("wmd-listing-nonce")).val(),f=this.elements,h={industry:{},tech:{},type:{},portfolio:{}};tinyMCE.triggerSave(),g=!0,h.content=tinyMCE.get("content").getContent(),h.id=c.find("#id").val();for(var i=0;i<f.length;i++){var j=f[i];if(j.hasAttribute("data-save")){var k=j.name.match(/wmd\[(.*)\]\[[0-9]{1,10}\]/);if(null!==k){var l=j.getAttribute("data-id");h.portfolio[l]=j.value}else"industry"===j.id?h.industry=b("#industry").select2("val"):"techonologies"===j.id?h.tech=b("#techonologies").select2("val"):"services"===j.id?h.type=b("#services").select2("val"):h[j.id]=j.value}}WMD.ajax("wmd_save_listing_post",d,h)})},ajax:function(a,b,c){f.ajax.send(a,{success:WMD.ajaxSuccess,error:WMD.ajaxError,data:{nonce:b,data:c}})},ajaxSuccess:function(a){if(g)WMD.postNotifications("success",a);else{var b=d.next().attr("id");"add-city"===b?WMD.ajaxCitySuccess(a):WMD.ajaxTaxSuccess(a)}},ajaxTaxSuccess:function(a){var b='<option value="'+a.term_id+'" selected="selected">'+a.name+"*</option>",c=d.prev().prev(),e=c.select2("val"),f=a.name+" has been created and is being reviewed*. Your option will display on your listing soon.";d.val("").prev().prev().append(b),e.push(a.term_id),c.select2("val",e),WMD.listingTaxNotification("success",f)},ajaxCitySuccess:function(a){console.log(a);var b='<option value="'+a.term_id+'" selected="selected">'+a.name+"</option>";d.val("").prev().append(b)},postNotifications:function(a,c){var d='<div class="wmd-notification wmd-'+a+'">'+c+' <a href="/membership-account/view-my-listing/">View Your Listing.</a></div',f=b(e.getElementById("wmd-notifications"));f.empty().html(d),b(e.getElementsByClassName("wmd-notification")).fadeIn()},ajaxError:function(a){g?WMD.postNotifications("error",a):WMD.listingTaxNotification("error",a)},listingTaxNotification:function(a,c){var f='<div class="wmd-notification wmd-'+a+'">'+c+"</div>";b(e.getElementsByClassName("wmd-notification")).fadeOut().remove(),d.next().after(f).next().fadeIn()},isInt:function(a){return!isNaN(a)&&function(a){return(0|a)===a}(parseFloat(a))},load:function(){b.flexslider&&b(".flexslider").flexslider({controlNav:!1})}},b(a).load(WMD.load),b(e).ready(WMD.init)}(this,jQuery);