/*! WIMP Member Directory - v0.1.0
 * http://beawimp.org/member-directory
 * Copyright (c) 2015;
 * Licensed GPLv2+
 */
var WMD;(function(t,e){"use strict";var i,a,n=t.document,o=t.wp,s=(t.tinymce,!1);WMD={init:function(){WMD.uploadLogo(),WMD.uploadPortfolio(),WMD.editListing(),WMD.saveListing(),e.fn.select2&&(e(".state-selection").select2({placeholder:"Select a state"}),e(".city-selection").select2({placeholder:"Select a city"}),e(".industry-selection").select2({placeholder:"What industries do you work with?"}),e(".tech-selection").select2({placeholder:"What technologies do you use?"}),e(".services-selection").select2({placeholder:"What services do you provide?"}))},uploadLogo:function(){e(n.getElementById("upload-image")).click(function(t){t.preventDefault(),WMD.media(e(t.target))})},uploadPortfolio:function(){e(n.getElementsByClassName("upload-portfolio")).click(function(t){t.preventDefault(),WMD.media(e(t.target))})},media:function(t){i!==undefined&&i.close(),i=o.media.frames.customHeader=o.media({title:"Upload image to your Directory Listing",library:{type:"image"},button:{text:"Insert Image"},multiple:!1}),i.on("select",function(){var a=i.state().get("selection").first().toJSON(),o=t.prev(),s=o.attr("id");if("logo-id"===s){var l=o.prev();o.val(a.id),l.val(a.url)}else if("portfolio"===o.attr("data-type")){var c=a.id,r="wmd[portfolio]["+c+"]",d=e(n.getElementById("portfolio-tmpl")).html();o.attr({name:r,"data-id":c}).val(a.url),t.parent().after(d)}else o.val(a.url)}),i.open()},editListing:function(){e(n.getElementsByClassName("add-new-tax")).click(function(t){t.preventDefault();var i=e(this),o=e(n.getElementById("wmd-listing-nonce")).val();a=i.prev();var s={term:a.val(),tax:a.attr("data-type")};"add-city"===i.attr("id")&&(s.isCity=!0),WMD.ajax("wmd_save_listing_tax",o,s)})},saveListing:function(){e(n.getElementById("wmd-listings")).submit(function(t){t.preventDefault();var i,a=e(this),o=e(n.getElementById("wmd-listing-nonce")).val(),l=this.elements,c=1,r={industry:{},tech:{},type:{},portfolio:{}};tinyMCE.triggerSave(),s=!0,r.content=tinyMCE.get("content").getContent(),r.id=a.find("#id").val();for(var d=0;l.length>d;d++){var u=l[d];if(u.hasAttribute("data-save"))if(WMD.isInt(u.id)){if(!u.checked)continue;var f=u.name.match(/wmd\[(.*)\]\[[0-9]{1,10}\]/);r[f[1]][c]=u.value,i&&f[1]!==i?c=1:c++,i=f[1]}else{var m=u.name.match(/wmd\[(.*)\]\[[0-9]{1,10}\]/);if(null!==m){var v=u.getAttribute("data-id");r.portfolio[v]=u.value}else r[u.id]=u.value}}WMD.ajax("wmd_save_listing_post",o,r)})},ajax:function(t,e,i){o.ajax.send(t,{success:WMD.ajaxSuccess,error:WMD.ajaxError,data:{nonce:e,data:i}})},ajaxSuccess:function(t){if(s)WMD.postNotifications("success",t);else{var e=a.next().attr("id");"add-city"===e?WMD.ajaxCitySuccess(t):WMD.ajaxTaxSuccess(t)}},ajaxTaxSuccess:function(t){var e='<option value="'+t.term_id+'">'+t.name+"</option>";a.val("").prev().after(e),WMD.listingTaxNotification("success","")},ajaxCitySuccess:function(t){console.log(t);var e='<option value="'+t.term_id+'" selected="selected">'+t.name+"</option>";a.val("").prev().append(e)},postNotifications:function(t,i){var a='<div class="wmd-notification wmd-'+t+'">'+i+' <a href="/membership-account/view-my-listing/">View Your Listing.</a></div',o=e(n.getElementById("wmd-notifications"));o.empty().html(a),e(n.getElementsByClassName("wmd-notification")).fadeIn()},ajaxError:function(t){s?WMD.postNotifications("error",t):WMD.listingTaxNotification("error",t)},listingTaxNotification:function(t,i){var o='<div class="wmd-notification wmd-'+t+'">'+i+"</div>";e(n.getElementsByClassName("wmd-notification")).fadeOut().remove(),a.next().after(o).next().fadeIn(),"success"===t&&e(n.getElementsByClassName("wmd-success")).fadeOut().remove()},isInt:function(t){return!isNaN(t)&&function(t){return(0|t)===t}(parseFloat(t))},load:function(){e.flexslider&&e(".flexslider").flexslider({controlNav:!1})}},e(t).load(WMD.load),e(n).ready(WMD.init)})(this,jQuery);