/*! WIMP Member Directory - v0.1.0
 * http://beawimp.org/member-directory
 * Copyright (c) 2015;
 * Licensed GPLv2+
 */
var WMD;(function(e,t){"use strict";var a,i,n=e.document,o=e.wp;WMD={init:function(){WMD.uploadLogo(),WMD.uploadPortfolio(),WMD.editListing(),WMD.saveListing()},uploadLogo:function(){t(n.getElementById("upload-image")).click(function(e){e.preventDefault(),WMD.media(t(e.target))})},uploadPortfolio:function(){t(n.getElementsByClassName("upload-portfolio")).click(function(e){e.preventDefault(),WMD.media(t(e.target))})},media:function(e){a!==undefined&&a.close(),a=o.media.frames.customHeader=o.media({title:"Upload image to your Directory Listing",library:{type:"image"},button:{text:"Insert Image"},multiple:!1}),a.on("select",function(){var t=a.state().get("selection").first().toJSON(),i=e.prev(),n=i.attr("id");if(console.log(n),"logo-id"===n){var o=i.prev();i.val(t.id),o.val(t.url)}else i.val(t.url)}),a.open()},editListing:function(){t(n.getElementsByClassName("add-new-tax")).click(function(e){e.preventDefault();var a=t(this),o=t(n.getElementById("wmd-listing-nonce")).val();i=a.prev();var l={term:i.val(),tax:i.attr("data-type")};WMD.ajax("wmd_save_listing_tax",o,l)})},saveListing:function(){t(n.getElementById("wmd-listings")).submit(function(e){e.preventDefault();var a,i=t(this),o=t(n.getElementById("wmd-listing-nonce")).val(),l=this.elements,r={industry:{},tech:{},type:{},portfolio:{}},s=1;r.content=i.find("#content").val(),r.id=i.find("#id").val();for(var d=0;l.length>d;d++){var c=l[d];if(c.hasAttribute("data-save"))if(WMD.isInt(c.id)){var u=c.name.match(/wmd\[(.*)\]\[[0-9]{1,10}\]/);r[u[1]][s]=c.value,a&&u[1]!==a?s=1:s++,a=u[1]}else{var m=c.name.match(/wmd\[(.*)\]\[[0-9]{1,10}\]/);if(null!==m){var f=c.getAttribute("data-id");r.portfolio[f]=c.value}else r[c.id]=c.value}}WMD.ajax("wmd_save_listing_post",o,r)})},ajax:function(e,t,a){o.ajax.send(e,{success:WMD.ajaxSuccess,error:WMD.ajaxError,data:{nonce:t,data:a}})},ajaxSuccess:function(e){var t='<label for="'+e.term_id+'">'+'<input type="checkbox" '+'name="wmd['+e.taxonomy+"]["+e.term_id+']" '+'value="'+e.name+'" '+'id="'+e.term_id+'" '+'checked="checked" /> '+e.name+"</label>";i.val("").prev().after(t)},ajaxError:function(e){WMD.listingTaxNotification("error",e)},listingTaxNotification:function(e,a){var o='<div class="wmd-notification wmd-'+e+'">'+a+"</div>";t(n.getElementsByClassName("wmd-notification")).fadeOut().remove(),i.next().after(o).next().fadeIn(),"success"===e&&t(n.getElementsByClassName("wmd-success")).fadeOut().remove()},isInt:function(e){return!isNaN(e)&&function(e){return(0|e)===e}(parseFloat(e))},load:function(){t(".flexslider").flexslider({controlNav:!1})}},t(e).load(WMD.load),t(n).ready(WMD.init)})(this,jQuery);